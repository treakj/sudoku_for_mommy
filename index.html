<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Sudoku</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
        }

        body.lang-ja {
            font-family: 'Noto Sans JP', sans-serif;
        }

        body.lang-pt,
        body.lang-en {
            font-family: 'Inter', sans-serif;
        }

        .canvas-container {
            width: 100%;
            max-width: 600px;
            aspect-ratio: 1 / 1;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 0.5rem;
        }

        .btn-difficulty.active {
            background-color: #1E40AF;
            color: white;
            border-color: #1E40AF;
        }

        #loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .btn-action:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <header class="text-center mb-4 relative">
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-gray-900">Jogo de Sudoku</h1>
            <p id="subtitle" class="text-gray-600 mt-1">Desafie sua lógica e divirta-se!</p>
            <button id="lang-toggle"
                class="absolute top-0 right-0 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg transition-colors">
                PT
            </button>
        </header>

        <main class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
            <!-- Controles de Dificuldade -->
            <div class="flex flex-wrap gap-2 sm:gap-4 justify-center mb-4 items-center">
                <div class="flex items-center gap-1 sm:gap-2 flex-wrap justify-center">
                    <span id="difficulty-label" class="font-semibold">Dificuldade:</span>
                    <button data-difficulty="easy"
                        class="btn-difficulty border-2 border-gray-300 px-2 py-1 rounded-md text-xs sm:text-sm font-medium transition-colors hover:bg-blue-100"
                        data-lang-key="easy">Fácil</button>
                    <button data-difficulty="medium"
                        class="btn-difficulty border-2 border-gray-300 px-2 py-1 rounded-md text-xs sm:text-sm font-medium transition-colors hover:bg-blue-100 active"
                        data-lang-key="medium">Médio</button>
                    <button data-difficulty="hard"
                        class="btn-difficulty border-2 border-gray-300 px-2 py-1 rounded-md text-xs sm:text-sm font-medium transition-colors hover:bg-blue-100"
                        data-lang-key="hard">Difícil</button>
                    <button data-difficulty="expert"
                        class="btn-difficulty border-2 border-gray-300 px-2 py-1 rounded-md text-xs sm:text-sm font-medium transition-colors hover:bg-blue-100"
                        data-lang-key="expert">Dificílimo</button>
                    <button data-difficulty="insane"
                        class="btn-difficulty border-2 border-gray-300 px-2 py-1 rounded-md text-xs sm:text-sm font-medium transition-colors hover:bg-blue-100"
                        data-lang-key="insane">Dificílimo Mesmo</button>
                </div>
            </div>

            <!-- Controles de Ação -->
            <div class="flex flex-wrap gap-2 sm:gap-4 justify-center mb-4">
                <button id="new-game-btn"
                    class="bg-blue-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-blue-700 transition-transform transform hover:scale-105"
                    data-lang-key="newGame">Novo Jogo</button>
                <button id="reset-btn"
                    class="bg-gray-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-gray-600 transition-transform transform hover:scale-105"
                    data-lang-key="reset">Limpar</button>
                <button id="hint-btn"
                    class="btn-action bg-green-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-green-600 transition-transform transform hover:scale-105"
                    data-lang-key="hint">Dica (3)</button>
                <button id="show-answer-btn"
                    class="btn-action bg-yellow-500 text-white px-4 py-2 rounded-md font-semibold hover:bg-yellow-600 transition-transform transform hover:scale-105"
                    data-lang-key="showAnswer">Resposta</button>
            </div>

            <!-- Canvas do Jogo -->
            <div class="canvas-container mx-auto relative">
                <canvas id="sudoku-canvas"></canvas>
                <div id="loader-container"
                    class="absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center hidden">
                    <div id="loader"></div>
                </div>
            </div>
            <!-- Painel de Números para Mobile -->
            <div id="number-panel" class="grid grid-cols-10 gap-1 mt-4">
                <button data-num="1"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">1</button>
                <button data-num="2"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">2</button>
                <button data-num="3"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">3</button>
                <button data-num="4"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">4</button>
                <button data-num="5"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">5</button>
                <button data-num="6"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">6</button>
                <button data-num="7"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">7</button>
                <button data-num="8"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">8</button>
                <button data-num="9"
                    class="num-btn bg-gray-200 p-2 rounded-md text-xl font-bold hover:bg-blue-200 aspect-square flex items-center justify-center">9</button>
                <button data-num="0"
                    class="num-btn bg-red-200 p-2 rounded-md text-xl font-bold hover:bg-red-300 aspect-square flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414 6.414a2 2 0 002.828 0L21 12M3 12l6.414-6.414a2 2 0 012.828 0L21 12" />
                    </svg>
                </button>
            </div>
        </main>

        <!-- Modal de Vitória -->
        <div id="win-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl text-center transform transition-all scale-95">
                <h2 id="win-title" class="text-3xl font-bold text-yellow-500 mb-2">Parabéns!</h2>
                <p id="win-subtitle" class="text-lg text-gray-700 mb-6">Você completou o Sudoku!</p>
                <button id="modal-new-game-btn"
                    class="bg-blue-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-blue-700 transition-transform transform hover:scale-105"
                    data-lang-key="playAgain">Jogar Novamente</button>
            </div>
        </div>

        <!-- Modal de Confirmação para Mostrar Resposta -->
        <div id="confirm-modal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl text-center transform transition-all scale-95">
                <h2 id="confirm-title" class="text-2xl font-bold text-gray-800 mb-4">Mostrar Resposta?</h2>
                <p id="confirm-subtitle" class="text-gray-600 mb-6">Isso preencherá todo o tabuleiro e encerrará o jogo
                    atual. Você tem certeza?</p>
                <div class="flex justify-center gap-4">
                    <button id="confirm-cancel-btn"
                        class="bg-gray-300 text-gray-800 px-6 py-2 rounded-md font-semibold hover:bg-gray-400"
                        data-lang-key="cancel">Cancelar</button>
                    <button id="confirm-show-btn"
                        class="bg-red-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-red-700"
                        data-lang-key="confirm">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // --- MÓDULO DE TRADUÇÃO ---
        const translations = {
            en: {
                mainTitle: "Sudoku Game",
                subtitle: "Challenge your logic and have fun!",
                difficultyLabel: "Difficulty:",
                easy: "Easy",
                medium: "Medium",
                hard: "Hard",
                expert: "Expert",
                insane: "Insane",
                newGame: "New Game",
                reset: "Reset",
                hint: "Hint",
                showAnswer: "Answer",
                winTitle: "Congratulations!",
                winSubtitle: "You have completed the Sudoku!",
                playAgain: "Play Again",
                confirmTitle: "Show Answer?",
                confirmSubtitle: "This will fill the entire board and end the current game. Are you sure?",
                cancel: "Cancel",
                confirm: "Confirm",
                langToggle: "JP"
            },
            pt: {
                mainTitle: "Jogo de Sudoku",
                subtitle: "Desafie sua lógica e divirta-se!",
                difficultyLabel: "Dificuldade:",
                easy: "Fácil",
                medium: "Médio",
                hard: "Difícil",
                expert: "Dificílimo",
                insane: "Dificílimo Mesmo",
                newGame: "Novo Jogo",
                reset: "Limpar",
                hint: "Dica",
                showAnswer: "Resposta",
                winTitle: "Parabéns!",
                winSubtitle: "Você completou o Sudoku!",
                playAgain: "Jogar Novamente",
                confirmTitle: "Mostrar Resposta?",
                confirmSubtitle: "Isso preencherá todo o tabuleiro e encerrará o jogo atual. Você tem certeza?",
                cancel: "Cancelar",
                confirm: "Confirmar",
                langToggle: "EN"
            },
            ja: {
                mainTitle: "数独ゲーム　（母ちゃん用）",
                subtitle: "論理に挑戦して楽しんでください！",
                difficultyLabel: "難易度:",
                easy: "簡単",
                medium: "中級",
                hard: "難しい",
                expert: "エキスパート",
                insane: "超難関　【真弓用）",
                newGame: "新しいゲーム",
                reset: "リセット",
                hint: "ヒント",
                showAnswer: "答え",
                winTitle: "おめでとうございます！",
                winSubtitle: "数独をクリアしました！",
                playAgain: "もう一度プレイ",
                confirmTitle: "答えを表示しますか？",
                confirmSubtitle: "これにより、すべてのマスが埋められ、現在のゲームは終了します。よろしいですか？",
                cancel: "キャンセル",
                confirm: "確認",
                langToggle: "PT"
            }
        };

        let currentLang = 'ja'; // Japonês como padrão

        function updateUIText() {
            document.body.className = document.body.className.replace(/lang-\w+/g, '');
            document.body.classList.add(`lang-${currentLang}`);

            const t = translations[currentLang];
            document.getElementById('main-title').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('difficulty-label').textContent = t.difficultyLabel;
            document.querySelector('[data-difficulty="easy"]').textContent = t.easy;
            document.querySelector('[data-difficulty="medium"]').textContent = t.medium;
            document.querySelector('[data-difficulty="hard"]').textContent = t.hard;
            document.querySelector('[data-difficulty="expert"]').textContent = t.expert;
            document.querySelector('[data-difficulty="insane"]').textContent = t.insane;
            document.getElementById('new-game-btn').textContent = t.newGame;
            document.getElementById('reset-btn').textContent = t.reset;
            document.getElementById('show-answer-btn').textContent = t.showAnswer;
            document.getElementById('win-title').textContent = t.winTitle;
            document.getElementById('win-subtitle').textContent = t.winSubtitle;
            document.getElementById('modal-new-game-btn').textContent = t.playAgain;
            document.getElementById('confirm-title').textContent = t.confirmTitle;
            document.getElementById('confirm-subtitle').textContent = t.confirmSubtitle;
            document.getElementById('confirm-cancel-btn').textContent = t.cancel;
            document.getElementById('confirm-show-btn').textContent = t.confirm;
            document.getElementById('lang-toggle').textContent = t.langToggle;
        }

        // --- MÓDULO: GERADOR DE PUZZLE ---
        class SudokuGenerator {
            constructor() { this.grid = this.createEmptyGrid(); }
            createEmptyGrid() { return Array(9).fill(0).map(() => Array(9).fill(0)); }
            generate(difficulty) {
                this.grid = this.createEmptyGrid();
                this._fillGrid(this.grid);
                const solution = this.grid.map(row => [...row]);
                this._removeNumbers(this.grid, difficulty);
                return { puzzle: this.grid, solution: solution };
            }
            _fillGrid(grid) {
                let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                let find = this._findEmpty(grid);
                if (!find) return true;
                let [row, col] = find;
                this._shuffle(numbers);
                for (let num of numbers) {
                    if (this._isValid(grid, row, col, num)) {
                        grid[row][col] = num;
                        if (this._fillGrid(grid)) return true;
                        grid[row][col] = 0;
                    }
                }
                return false;
            }
            _removeNumbers(grid, difficulty) {
                const removals = { easy: 40, medium: 50, hard: 56, expert: 61, insane: 64 }[difficulty];
                let count = removals;
                while (count > 0) {
                    let row = Math.floor(Math.random() * 9);
                    let col = Math.floor(Math.random() * 9);
                    if (grid[row][col] !== 0) {
                        grid[row][col] = 0;
                        count--;
                    }
                }
            }
            _isValid(grid, row, col, num) {
                for (let i = 0; i < 9; i++) {
                    if (grid[row][i] === num) return false;
                    if (grid[i][col] === num) return false;
                }
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                for (let i = 0; i < 3; i++) for (let j = 0; j < 3; j++) if (grid[startRow + i][startCol + j] === num) return false;
                return true;
            }
            _findEmpty(grid) {
                for (let r = 0; r < 9; r++) for (let c = 0; c < 9; c++) if (grid[r][c] === 0) return [r, c];
                return null;
            }
            _shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
        }

        // --- MÓDULO: VALIDADOR ---
        class Validator {
            isMoveValid(board, row, col, num) {
                for (let i = 0; i < 9; i++) {
                    if (board[row][i] === num && i !== col) return false;
                    if (board[i][col] === num && i !== row) return false;
                }
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                for (let i = 0; i < 3; i++) for (let j = 0; j < 3; j++) if (board[startRow + i][startCol + j] === num && (startRow + i !== row || startCol + j !== col)) return false;
                return true;
            }
        }

        // --- MÓDULO: JOGO ---
        class SudokuGame {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.loader = document.getElementById('loader-container');
                this.hintBtn = document.getElementById('hint-btn');
                this.difficulty = 'medium';
                this.validator = new Validator();
                this.generator = new SudokuGenerator();
                this.selected = { row: -1, col: -1 };
                this.boardSize = 0;
                this.cellSize = 0;
                this.init();
            }

            init() {
                this.setupCanvas();
                this.startNewGame();
                this.addEventListeners();
                window.addEventListener('resize', () => this.resizeAndDraw());
            }

            setupCanvas() {
                const container = this.canvas.parentElement;
                const size = container.clientWidth;
                this.canvas.width = size;
                this.canvas.height = size;
                this.boardSize = size;
                this.cellSize = this.boardSize / 9;
            }

            startNewGame() {
                this.showLoader();
                setTimeout(() => {
                    const { puzzle, solution } = this.generator.generate(this.difficulty);
                    this.initialBoard = puzzle;
                    this.solution = solution;
                    this.playerBoard = this.initialBoard.map(row => [...row]);
                    this.conflicts = this.createEmptyGrid(false);
                    this.selected = { row: -1, col: -1 };
                    this.hintsLeft = 3;
                    this.updateHintButton();
                    this.updateConflicts();
                    this.draw();
                    this.hideLoader();
                }, 50);
            }

            resetBoard() {
                if (!this.initialBoard) return;
                this.playerBoard = this.initialBoard.map(row => [...row]);
                this.updateConflicts();
                this.draw();
            }

            showLoader() { this.loader.classList.remove('hidden'); }
            hideLoader() { this.loader.classList.add('hidden'); }
            createEmptyGrid(initialValue) { return Array(9).fill(0).map(() => Array(9).fill(initialValue)); }

            addEventListeners() {
                this.canvas.addEventListener('click', this.handleCanvasClick.bind(this));
                this.canvas.addEventListener('touchstart', this.handleCanvasClick.bind(this), { passive: true });
                window.addEventListener('keydown', this.handleKeyDown.bind(this));
                this.hintBtn.addEventListener('click', this.useHint.bind(this));
            }

            handleCanvasClick(e) {
                const rect = this.canvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const x = clientX - rect.left;
                const y = clientY - rect.top;
                const col = Math.floor(x / this.cellSize);
                const row = Math.floor(y / this.cellSize);
                if (col >= 0 && col < 9 && row >= 0 && row < 9) {
                    this.selected = { row, col };
                    this.draw();
                }
            }

            handleKeyDown(e) {
                if (this.selected.row === -1) return;
                if (e.key >= '1' && e.key <= '9') {
                    this.placeNumber(this.selected.row, this.selected.col, parseInt(e.key));
                } else if (e.key === 'Backspace' || e.key === 'Delete') {
                    this.placeNumber(this.selected.row, this.selected.col, 0);
                } else if (e.key.startsWith('Arrow')) {
                    e.preventDefault();
                    let { row, col } = this.selected;
                    if (e.key === 'ArrowUp' && row > 0) row--;
                    else if (e.key === 'ArrowDown' && row < 8) row++;
                    else if (e.key === 'ArrowLeft' && col > 0) col--;
                    else if (e.key === 'ArrowRight' && col < 8) col++;
                    this.selected = { row, col };
                    this.draw();
                }
            }

            placeNumber(row, col, num) {
                if (row === -1 || (this.initialBoard && this.initialBoard[row][col] !== 0)) return;
                this.playerBoard[row][col] = num;
                this.updateConflicts();
                this.draw();
                this.checkWinCondition();
            }

            useHint() {
                if (this.hintsLeft <= 0) return;
                const emptyCells = [];
                for (let r = 0; r < 9; r++) for (let c = 0; c < 9; c++) if (this.playerBoard[r][c] === 0) emptyCells.push({ r, c });
                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    const { r, c } = randomCell;
                    const correctNumber = this.solution[r][c];
                    this.placeNumber(r, c, correctNumber);
                    this.hintsLeft--;
                    this.updateHintButton();
                }
            }

            updateHintButton() {
                this.hintBtn.textContent = `${translations[currentLang].hint} (${this.hintsLeft})`;
                this.hintBtn.disabled = this.hintsLeft <= 0;
            }

            showAnswer() {
                this.playerBoard = this.solution.map(row => [...row]);
                this.updateConflicts();
                this.draw();
            }

            updateConflicts() {
                this.conflicts = this.createEmptyGrid(false);
                for (let r = 0; r < 9; r++) for (let c = 0; c < 9; c++) if (this.playerBoard[r][c] !== 0) if (!this.validator.isMoveValid(this.playerBoard, r, c, this.playerBoard[r][c])) this.conflicts[r][c] = true;
            }

            checkWinCondition() {
                for (let r = 0; r < 9; r++) for (let c = 0; c < 9; c++) if (this.playerBoard[r][c] === 0 || this.conflicts[r][c]) return;
                this.showWinModal();
            }

            showWinModal() {
                const modal = document.getElementById('win-modal');
                modal.classList.remove('hidden');
                setTimeout(() => modal.querySelector('div').classList.remove('scale-95'), 10);
            }

            showConfirmModal() {
                const modal = document.getElementById('confirm-modal');
                modal.classList.remove('hidden');
                setTimeout(() => modal.querySelector('div').classList.remove('scale-95'), 10);
            }

            hideConfirmModal() {
                const modal = document.getElementById('confirm-modal');
                modal.querySelector('div').classList.add('scale-95')
                setTimeout(() => modal.classList.add('hidden'), 150);
            }

            draw() {
                this.ctx.clearRect(0, 0, this.boardSize, this.boardSize);
                this.drawHighlights();
                this.drawGrid();
                this.drawNumbers();
            }

            drawGrid() {
                this.ctx.strokeStyle = '#9CA3AF';
                for (let i = 0; i <= 9; i++) {
                    this.ctx.lineWidth = (i % 3 === 0) ? 3 : 1;
                    this.ctx.beginPath(); this.ctx.moveTo(i * this.cellSize, 0); this.ctx.lineTo(i * this.cellSize, this.boardSize); this.ctx.stroke();
                    this.ctx.beginPath(); this.ctx.moveTo(0, i * this.cellSize); this.ctx.lineTo(this.boardSize, i * this.cellSize); this.ctx.stroke();
                }
            }

            drawHighlights() {
                if (this.selected.row === -1) return;
                const { row, col } = this.selected;
                const x = col * this.cellSize; const y = row * this.cellSize;
                this.ctx.fillStyle = '#EBF4FF';
                this.ctx.fillRect(0, y, this.boardSize, this.cellSize);
                this.ctx.fillRect(x, 0, this.cellSize, this.boardSize);
                const startRow = Math.floor(row / 3) * 3; const startCol = Math.floor(col / 3) * 3;
                this.ctx.fillRect(startCol * this.cellSize, startRow * this.cellSize, this.cellSize * 3, this.cellSize * 3);
                this.ctx.fillStyle = '#BFDBFE';
                this.ctx.fillRect(x, y, this.cellSize, this.cellSize);
            }

            drawNumbers() {
                const fontSize = this.cellSize * 0.6;
                this.ctx.font = `bold ${fontSize}px 'Inter', 'Noto Sans JP', sans-serif`;
                this.ctx.textAlign = 'center'; this.ctx.textBaseline = 'middle';
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        const num = this.playerBoard[r][c];
                        if (num === 0) continue;
                        const x = c * this.cellSize + this.cellSize / 2;
                        const y = r * this.cellSize + this.cellSize / 2;
                        if (this.conflicts[r][c]) this.ctx.fillStyle = '#EF4444';
                        else if (this.initialBoard[r][c] !== 0) this.ctx.fillStyle = '#1F2937';
                        else this.ctx.fillStyle = '#1E40AF';
                        this.ctx.fillText(num.toString(), x, y);
                    }
                }
            }

            resizeAndDraw() { this.setupCanvas(); this.draw(); }
        }

        // --- PONTO DE ENTRADA DA APLICAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            const game = new SudokuGame('sudoku-canvas');

            // --- Event Listeners dos Controles ---
            document.querySelectorAll('.btn-difficulty').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.btn-difficulty').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    game.difficulty = btn.dataset.difficulty;
                    game.startNewGame();
                });
            });

            document.getElementById('new-game-btn').addEventListener('click', () => game.startNewGame());
            document.getElementById('reset-btn').addEventListener('click', () => game.resetBoard());

            document.getElementById('modal-new-game-btn').addEventListener('click', () => {
                document.getElementById('win-modal').classList.add('hidden');
                game.startNewGame();
            });

            document.querySelectorAll('.num-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (game.selected.row !== -1) {
                        const num = parseInt(btn.dataset.num);
                        game.placeNumber(game.selected.row, game.selected.col, num);
                    }
                });
            });

            // Lógica do Modal de Confirmação
            document.getElementById('show-answer-btn').addEventListener('click', () => game.showConfirmModal());
            document.getElementById('confirm-cancel-btn').addEventListener('click', () => game.hideConfirmModal());
            document.getElementById('confirm-show-btn').addEventListener('click', () => {
                game.showAnswer();
                game.hideConfirmModal();
            });

            // Lógica do Seletor de Idioma
            document.getElementById('lang-toggle').addEventListener('click', () => {
                if (currentLang === 'ja') currentLang = 'pt';
                else if (currentLang === 'pt') currentLang = 'en';
                else currentLang = 'ja';
                updateUIText();
                game.updateHintButton();
            });

            // Inicia a UI com o idioma padrão
            updateUIText();
        });

    </script>
</body>

</html>